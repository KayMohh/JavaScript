<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive To-Do List â€” Project 1</title>
  <style>
    /* Simple, clean styles for the To-Do List */
    :root {
      --bg: #f6f8fb;
      --card: #ffffff;
      --accent: #2b7cff;
      --muted: #6b7280;
      --success: #16a34a;
      --danger: #ef4444;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, var(--bg), #e9eef8);
      margin: 0;
      padding: 32px;
      display: flex;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 640px;
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 6px 20px rgba(43, 124, 255, 0.06);
    }

    h1 {
      margin: 0 0 8px;
      font-size: 20px;
      color: #0f172a;
    }

    p.lead {
      margin: 0 0 16px;
      color: var(--muted);
      font-size: 14px;
    }

    .input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    input#taskInput {
      flex: 1;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #dbe4ff;
      outline: none;
      font-size: 14px;
    }

    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    button.secondary {
      background: #f3f4f6;
      color: #111827;
      border: 1px solid #e5e7eb;
    }

    .controls {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .filters {
      display: flex;
      gap: 8px;
      margin-left: auto;
      align-items: center;
    }

    ul#taskList {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 8px;
    }

    li.task {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #eef2ff;
      background: linear-gradient(180deg, white, #fbfdff);
      box-shadow: 0 1px 0 rgba(10, 25, 47, 0.02);
    }

    .task .text {
      flex: 1;
      word-break: break-word;
    }

    .task.done .text {
      text-decoration: line-through;
      color: var(--muted);
    }

    .task .actions {
      display: flex;
      gap: 8px;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 12px;
      background: #eef2ff;
      color: #1e3a8a;
    }

    .small {
      font-size: 12px;
      color: var(--muted);
    }

    /* Responsive */
    @media (max-width: 520px) {
      .input-row {
        flex-direction: column;
      }
      .filters {
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container" role="application" aria-label="To-do list app">
    <h1>Interactive To-Do List</h1>
    <p class="lead">Add tasks, mark them complete, edit or delete, and your tasks will be saved in your browser.</p>

    <div class="input-row">
      <input id="taskInput" type="text" placeholder="Add a new task (e.g., Buy groceries)" aria-label="New task input">
      <button id="addBtn">Add</button>
    </div>

    <div class="controls">
      <div class="small">Tasks: <span id="taskCount">0</span></div>
      <div class="filters" aria-hidden="false">
        <button class="secondary" id="showAll">All</button>
        <button class="secondary" id="showActive">Active</button>
        <button class="secondary" id="showCompleted">Completed</button>
      </div>
      <div style="margin-left:auto; display:flex; gap:8px;">
        <button id="clearCompleted" class="secondary">Clear Completed</button>
        <button id="clearAll" class="secondary">Clear All</button>
      </div>
    </div>

    <ul id="taskList" aria-live="polite"></ul>

    <p class="small" style="margin-top:12px;">
      Tip: Press <kbd>Enter</kbd> while typing to add a task.
    </p>
  </div>

  <script>
    /*********************************************************
     * Interactive To-Do List
     * - Uses DOM manipulation to render tasks
     * - Uses localStorage to persist tasks between page loads
     * - Beginner-friendly and well-commented
     *********************************************************/

    // Select important DOM elements and store references for reuse
    const taskInput = document.getElementById('taskInput');
    const addBtn = document.getElementById('addBtn');
    const taskList = document.getElementById('taskList');
    const taskCount = document.getElementById('taskCount');
    const showAllBtn = document.getElementById('showAll');
    const showActiveBtn = document.getElementById('showActive');
    const showCompletedBtn = document.getElementById('showCompleted');
    const clearCompletedBtn = document.getElementById('clearCompleted');
    const clearAllBtn = document.getElementById('clearAll');

    // App state: array of task objects { id, text, done }
    let tasks = [];

    // Filter state: 'all' | 'active' | 'completed'
    let filter = 'all';

    // --- Helper: generate unique id for tasks ---
    function generateId() {
      // Simple id using timestamp + random number
      return Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
    }

    // --- Persist to localStorage ---
    function saveTasks() {
      // Convert tasks array to JSON string and save
      localStorage.setItem('todo.tasks', JSON.stringify(tasks));
    }

    // --- Load tasks from localStorage ---
    function loadTasks() {
      const raw = localStorage.getItem('todo.tasks');
      if (raw) {
        try {
          tasks = JSON.parse(raw);
          // Ensure tasks is an array (guard against corrupted data)
          if (!Array.isArray(tasks)) tasks = [];
        } catch (e) {
          console.error('Failed to parse stored tasks:', e);
          tasks = [];
        }
      } else {
        tasks = [];
      }
    }

    // --- Render tasks to the DOM based on the current filter ---
    function render() {
      // Clear current list
      taskList.innerHTML = '';

      // Compute filtered tasks
      const visibleTasks = tasks.filter(task => {
        if (filter === 'active') return !task.done;
        if (filter === 'completed') return task.done;
        return true; // all
      });

      // Update task count
      taskCount.textContent = visibleTasks.length;

      // Create DOM elements for each task
      visibleTasks.forEach(task => {
        const li = document.createElement('li');
        li.className = 'task' + (task.done ? ' done' : '');
        li.setAttribute('data-id', task.id);

        // checkbox to toggle completed status
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = task.done;
        checkbox.setAttribute('aria-label', 'Mark task complete');

        // text span - editable (we'll allow inline edit on double click)
        const textSpan = document.createElement('div');
        textSpan.className = 'text';
        textSpan.textContent = task.text;

        // actions container
        const actions = document.createElement('div');
        actions.className = 'actions';

        // Edit button
        const editBtn = document.createElement('button');
        editBtn.textContent = 'Edit';
        editBtn.title = 'Edit task';
        editBtn.className = 'secondary';

        // Delete button
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.title = 'Delete task';
        deleteBtn.style.background = 'var(--danger)';
        deleteBtn.style.color = 'white';

        // Append elements
        li.appendChild(checkbox);
        li.appendChild(textSpan);
        actions.appendChild(editBtn);
        actions.appendChild(deleteBtn);
        li.appendChild(actions);
        taskList.appendChild(li);

        // --- Event listeners for this task's controls ---

        // Toggle completion when checkbox changes
        checkbox.addEventListener('change', () => {
          toggleDone(task.id);
        });

        // Delete task on clicking delete button
        deleteBtn.addEventListener('click', () => {
          deleteTask(task.id);
        });

        // Edit: allow inline editing
        editBtn.addEventListener('click', () => {
          startEditingTask(task.id, textSpan);
        });

        // Also support double click on text to edit
        textSpan.addEventListener('dblclick', () => {
          startEditingTask(task.id, textSpan);
        });
      });
    }

    // --- Add a new task ---
    function addTask(text) {
      const trimmed = text.trim();
      if (!trimmed) return; // ignore empty tasks

      const newTask = {
        id: generateId(),
        text: trimmed,
        done: false
      };

      tasks.push(newTask);
      saveTasks();
      render();
    }

    // --- Toggle the done state of a task by id ---
    function toggleDone(id) {
      tasks = tasks.map(t => {
        if (t.id === id) {
          return { ...t, done: !t.done };
        }
        return t;
      });
      saveTasks();
      render();
    }

    // --- Delete a task by id ---
    function deleteTask(id) {
      tasks = tasks.filter(t => t.id !== id);
      saveTasks();
      render();
    }

    // --- Start editing a task inline ---
    function startEditingTask(id, textSpan) {
      // Replace the textSpan with an input element temporarily
      const originalText = textSpan.textContent;
      const input = document.createElement('input');
      input.type = 'text';
      input.value = originalText;
      input.style.padding = '6px';
      input.style.borderRadius = '6px';
      input.style.border = '1px solid #d1d5db';
      input.style.width = '100%';

      // Replace node
      textSpan.replaceWith(input);
      input.focus();
      // Move cursor to end
      input.setSelectionRange(input.value.length, input.value.length);

      // Save edited value on Enter, or cancel on Escape, or blur
      function finishEdit(save) {
        if (save) {
          const newText = input.value.trim();
          if (newText) {
            tasks = tasks.map(t => (t.id === id ? { ...t, text: newText } : t));
            saveTasks();
          }
        }
        // Replace input with updated text span
        const newTextSpan = document.createElement('div');
        newTextSpan.className = 'text';
        // find the possibly updated text from tasks array to show latest
        const updatedTask = tasks.find(t => t.id === id);
        newTextSpan.textContent = updatedTask ? updatedTask.text : originalText;
        input.replaceWith(newTextSpan);

        // Reattach dblclick edit handler so user can edit again
        newTextSpan.addEventListener('dblclick', () => {
          startEditingTask(id, newTextSpan);
        });

        render(); // ensure consistent UI
      }

      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') finishEdit(true);
        if (e.key === 'Escape') finishEdit(false);
      });

      input.addEventListener('blur', () => finishEdit(true));
    }

    // --- Clear completed tasks ---
    function clearCompleted() {
      tasks = tasks.filter(t => !t.done);
      saveTasks();
      render();
    }

    // --- Clear all tasks (with confirmation) ---
    function clearAll() {
      const confirmed = confirm('Clear all tasks? This cannot be undone.');
      if (!confirmed) return;
      tasks = [];
      saveTasks();
      render();
    }

    // --- Event listeners for UI controls ---
    addBtn.addEventListener('click', () => {
      addTask(taskInput.value);
      taskInput.value = '';
      taskInput.focus();
    });

    // Allow Enter key in input to add a task
    taskInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        addTask(taskInput.value);
        taskInput.value = '';
      }
    });

    showAllBtn.addEventListener('click', () => {
      filter = 'all';
      highlightFilterButtons();
      render();
    });

    showActiveBtn.addEventListener('click', () => {
      filter = 'active';
      highlightFilterButtons();
      render();
    });

    showCompletedBtn.addEventListener('click', () => {
      filter = 'completed';
      highlightFilterButtons();
      render();
    });

    clearCompletedBtn.addEventListener('click', () => {
      clearCompleted();
    });

    clearAllBtn.addEventListener('click', () => {
      clearAll();
    });

    // --- Visual helper: show which filter is active ---
    function highlightFilterButtons() {
      const map = { all: showAllBtn, active: showActiveBtn, completed: showCompletedBtn };
      Object.keys(map).forEach(key => {
        map[key].classList.toggle('secondary', filter !== key);
        // Give the active filter a subtle accent
        if (filter === key) {
          map[key].style.background = 'var(--accent)';
          map[key].style.color = 'white';
        } else {
          map[key].style.background = '';
          map[key].style.color = '';
        }
      });
    }

    // --- Initialize app: load, then render ---
    function init() {
      loadTasks();
      highlightFilterButtons();
      render();
    }

    // Run the init function when the script loads
    init();
  </script>
</body>
</html>
